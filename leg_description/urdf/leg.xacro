<?xml version="1.0" ?>
<robot name="leg" xmlns:xacro="http://www.ros.org/wiki/xacro">

<xacro:include filename="$(find leg_description)/urdf/materials.xacro" />
<!-- <xacro:include filename="$(find leg_description)/urdf/leg.gazebo" /> -->

<xacro:macro name="leg" params="side num x y z angle joint_effort joint_velocity">

<link name="leg_base_${side}${num}">
  <inertial>
    <origin rpy="0 0 0" xyz="-0.004871681061061522 0.00011643429551521872 0.019692846258153093"/>
    <mass value="8.341020253462162"/>
    <inertia  ixx="0.03835511729075018" ixy="0" ixz="0" iyy="0.03559944541918172" iyz="0" izz="0.06699597967785346" />
  </inertial>
  <visual>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/leg_base_link.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/leg_base_link.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="femur_base_${side}${num}">
  <inertial>
    <origin rpy="0 0 0" xyz="0.10872635808676938 0.008582554861478622 0.01963983681426297"/>
    <mass value="5.7419415798639255"/>
    <inertia  ixx="0.01611425340990051" ixy="0" ixz="0" iyy="0.055107473001172" iyz="0" izz="0.06303439424158978" />
  </inertial>
  <visual>
    <origin rpy="0 0 0" xyz="-0.0 0.0 -0.05"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/femur_base_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="white"/>
  </visual>
  <collision>
    <origin rpy="0 0 0" xyz="-0.0 0.0 -0.05"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/femur_base_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="femur_link_${side}${num}">
  <inertial>
    <origin rpy="0 0 0" xyz="0.03630026202441122 7.870816556624017e-05 0.10443637465493055"/>
    <mass value="4.728983887639144"/>
    <inertia  ixx="0.008957273120998479" ixy="0" ixz="0" iyy="0.05425147958442127" iyz="0" izz="0.05680332607908645" />
  </inertial>
  <visual>
    <origin rpy="1.5708 -1.045 0" xyz="0 0 0"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/femur_assembly_v2.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin rpy="1.5708 -1.045 0" xyz="0 0 0"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/femur_assembly_v2.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="tibia_link_${side}${num}">
  <inertial>
    <origin rpy="0 0 0" xyz="0.09817993031034078 -3.4785017669889708e-06 -0.11373105818820523"/>
    <mass value="5.477504097726574"/>
    <inertia  ixx="0.08900047312320263" ixy="0" ixz="0" iyy="0.012196295613728567" iyz="0" izz="0.09412713678146542" />
  </inertial>
  <visual>
    <origin rpy="1.5708 0 0" xyz="0 0 0"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/tibia_assembly_v2.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="black"/>
  </visual>
  <collision>
    <origin rpy="1.5708 0 0" xyz="0 0 0"/>
    <geometry>
      <mesh filename="package://leg_description/meshes/tibia_assembly_v2.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="leg_tip_touch${side}${num}" >
  <inertial>
    <origin rpy="0 0 0" xyz="0.09817993031034078 -3.4785017669889708e-06 -0.11373105818820523"/>
    <mass value="1.0"/>
    <inertia ixx="0.000006" ixy="-0.0" ixz="0.023385" iyy="0.000006" iyz="-0.0" izz="0.000006"/>
  </inertial>
  <visual>
    <origin rpy="1.5708 0 0" xyz="0 0 0"/>
    <geometry>
        <sphere radius="0.03"/>
    </geometry>
    <material name="black"/>
  </visual>
  <collision>
    <origin rpy="1.5708 0 0" xyz="0 0 0"/>
    <geometry>
        <sphere radius="0.03"/>
    </geometry>
  </collision>
</link>

<link name="leg_tip_${side}${num}" >
  <inertial>
    <origin rpy="0 0 0" xyz="0.09817993031034078 -3.4785017669889708e-06 -0.11373105818820523"/>
    <mass value="0.01"/>
    <inertia ixx="0.000006" ixy="-0.0" ixz="0.023385" iyy="0.000006" iyz="-0.0" izz="0.000006"/>
  </inertial>
  <!-- <visual>
    <origin rpy="1.5708 0 0" xyz="0 0 0"/>
    <geometry>
        <sphere radius="0.003"/>
    </geometry>
    <material name="black"/>
  </visual>
  <collision>
    <origin rpy="1.5708 0 0" xyz="0 0 0"/>
    <geometry>
        <sphere radius="0.003"/>
    </geometry>
  </collision> -->
</link>

<link name="tip_inter_${side}${num}" >
  <inertial>
    <origin rpy="0 0 0" xyz="0.09817993031034078 -3.4785017669889708e-06 -0.11373105818820523"/>
    <mass value="0.01"/>
    <inertia ixx="0.000006" ixy="-0.0" ixz="0.023385" iyy="0.000006" iyz="-0.0" izz="0.000006"/>
  </inertial>

</link>

<link name="tip_${side}${num}" >
  <inertial>
    <origin rpy="0 0 0" xyz="0.09817993031034078 -3.4785017669889708e-06 -0.11373105818820523"/>
    <mass value="0.01"/>
    <inertia ixx="0.000006" ixy="-0.0" ixz="0.023385" iyy="0.000006" iyz="-0.0" izz="0.000006"/>
  </inertial>

</link>

<joint name="joint_base_link_${side}${num}" type="fixed">
  <origin xyz="${x} ${y} ${z}" rpy="0 0 ${angle}" />
  <parent link="base_link"/>
  <child link="leg_base_${side}${num}"/>
</joint>

<joint name="joint_base_${side}${num}" type="revolute">
  <origin rpy="0 0 0" xyz="0.0 0.0 0.05"/>
  <parent link="leg_base_${side}${num}"/>
  <child link="femur_base_${side}${num}"/>
  <axis xyz="0.0 0.0 -1.0"/>
  <limit lower="-1.1" upper="1.1" effort="${joint_effort}" velocity="${joint_velocity}" />
</joint>

<joint name="joint_femur_${side}${num}" type="revolute">
  <origin rpy="0 0 0" xyz="0.155492 -0.000545 0.065003"/>
  <parent link="femur_base_${side}${num}"/>
  <child link="femur_link_${side}${num}"/>
  <axis xyz="0.0 1.0 0.0"/>
  <limit lower="-0.8" upper="0.9" effort="${joint_effort}" velocity="${joint_velocity}" />
</joint>

<joint name="joint_tibia_${side}${num}" type="revolute">
  <origin rpy="0 0 0" xyz="0.100634 -2e-06 0.282178"/>
  <parent link="femur_link_${side}${num}"/>
  <child link="tibia_link_${side}${num}"/>
  <axis xyz="0.0 1.0 0.0"/>
  <limit lower="-1.5" upper="0.0" effort="${joint_effort}" velocity="${joint_velocity}" />
</joint>
  
<joint name="tibia_foot_touch_joint_${side}${num}" type="fixed">
  <origin xyz="0.08 0 -0.40" rpy="0 0 -1.57" />
  <parent link="tibia_link_${side}${num}" />
  <child link="leg_tip_touch${side}${num}" />
</joint>

<joint name="tibia_foot_joint_${side}${num}" type="revolute">
  <origin xyz="0.08 0 -0.40" rpy="0 0 -1.57" />
  <parent link="tibia_link_${side}${num}" />
  <child link="leg_tip_${side}${num}" />
  <axis xyz="1.0 0.0 0.0"/>
  <limit lower="-3.14" upper="3.14" effort="0.0" velocity="0.0" />
</joint>

<joint name="leg_tip_inter_joint_${side}${num}" type="revolute">
  <origin xyz="0.0 0 -0.0" rpy="0.0 0 0.0" />
  <parent link="leg_tip_${side}${num}" />
  <child link="tip_inter_${side}${num}" />
  <axis xyz="0.0 1.0 0.0"/>
  <limit lower="-3.14" upper="3.14" effort="0.0" velocity="0.0" />
</joint>

<joint name="leg_tip_joint_${side}${num}" type="revolute">
  <origin xyz="0.0 0 -0.0" rpy="0.0 0 0.0" />
  <parent link="tip_inter_${side}${num}" />
  <child link="tip_${side}${num}" />
  <axis xyz="0.0 0.0 1.0"/>
  <limit lower="-3.14" upper="3.14" effort="0.0" velocity="0.0" />
</joint>

<!-- leg gazebo properties -->
<gazebo reference="base_link">
  <material>Gazebo/Red</material>
  <!-- <mu1>0.2</mu1> -->
  <!-- <mu2>0.2</mu2> -->
  <!-- <selfCollide>false</selfCollide> -->
  <!-- <gravity>true</gravity> -->
</gazebo>

<gazebo reference="leg_base_${side}${num}">
  <material>Gazebo/White</material>
  <!-- <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>false</selfCollide> -->
</gazebo>

<gazebo reference="femur_base_${side}${num}">
  <material>Gazebo/Black</material>
  <!-- <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>false</selfCollide> -->
</gazebo>

<gazebo reference="femur_link_${side}${num}">
  <material>Gazebo/White</material>
  <!-- <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>false</selfCollide> -->
</gazebo>

<gazebo reference="tibia_link_${side}${num}">
  <material>Gazebo/Black</material>
  <!-- <mu1>0.2</mu1>
  <mu2>0.2</mu2>
  <selfCollide>false</selfCollide> -->
</gazebo>

<gazebo reference="leg_tip_touch${side}${num}">
  <!-- <kp>10.0</kp>
  <kd>0.01</kd> -->
  <mu>0.90</mu>
  <mu1>0.90</mu1>
  <mu2>0.90</mu2>
  <maxVel>0.0</maxVel>
  <!-- <minDepth>0.001</minDepth> -->
  <material>Gazebo/FlatBlack</material>
  <selfCollide>false</selfCollide>
</gazebo>

<gazebo reference="leg_tip_${side}${num}">
  <!-- <kp>1000000.0</kp>
  <kd>1.0</kd>
  <mu1>1000000.0</mu1>
  <mu2>1000000.0</mu2>
  <maxVel>0.0</maxVel>
  <minDepth>0.001</minDepth> -->
  <material>Gazebo/FlatBlack</material>
</gazebo>

<gazebo reference="tip_inter_${side}${num}">
  <!-- <kp>1000000.0</kp>
  <kd>1.0</kd>
  <mu1>100.0</mu1>
  <mu2>100.0</mu2>
  <maxVel>0.0</maxVel>
  <minDepth>0.001</minDepth> -->
  <material>Gazebo/FlatBlack</material>
</gazebo>

<gazebo reference="tip_${side}${num}">
  <!-- <kp>1000000.0</kp>
  <kd>1.0</kd>
  <mu1>0.8</mu1>
  <mu2>0.8</mu2>
  <maxVel>0.0</maxVel>
  <minDepth>0.001</minDepth> -->
  <material>Gazebo/FlatBlack</material>
</gazebo>


<!-- Leg transmission properties  -->
<transmission name="joint_base_${side}${num}_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="joint_base_${side}${num}">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="joint_base_${side}${num}_actr">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="joint_femur_${side}${num}_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="joint_femur_${side}${num}">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="joint_femur_${side}${num}_actr">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="joint_tibia_${side}${num}_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="joint_tibia_${side}${num}">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="joint_tibia_${side}${num}_actr">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="tibia_foot_joint_${side}${num}_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="tibia_foot_joint_${side}${num}">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="tibia_foot_joint_${side}${num}_actr">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="leg_tip_inter_joint_${side}${num}_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="leg_tip_inter_joint_${side}${num}">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="leg_tip_inter_joint_${side}${num}_actr">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<transmission name="leg_tip_joint_${side}${num}_tran">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="leg_tip_joint_${side}${num}">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="leg_tip_joint_${side}${num}_actr">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>
</xacro:macro>

</robot>
